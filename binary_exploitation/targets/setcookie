#!/opt/conda/bin/python3

import sys
import hashlib
from os import path

if len(sys.argv) < 2:
    print("Usage: %s <uniqname> ..." % sys.argv[0], file=sys.stderr)
    sys.exit(1)

if "uniqname" in ''.join(sys.argv[1:]):
    print("Remember to replace <uniqname> with your actual uniqname!", file=sys.stderr)
    sys.exit(1)

if path.isfile("cookie"):
    print("Cookie is already set. Run 'make clean' before trying to change it.", file=sys.stderr)
    sys.exit(1)

with open("cookie", "w") as file:
    h = hashlib.sha256(('|'.join(sorted(sys.argv[1:])).lower()).encode()).digest()
    print(int.from_bytes(h, byteorder='little') % 0x8FFF, file=file)
    print("Cookie set for "+",".join(sys.argv[1:]) + ". Now run 'make'.")
