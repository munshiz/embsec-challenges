SHELL := /bin/bash
CC := arm-linux-gnueabi-gcc
CFLAGS := -static -U_FORTIFY_SOURCE -DCOOKIE=$(shell cat cookie) -Wno-implicit-function-declaration
LDFLAGS :=
LDLIBS :=

targets := target0 target1 target2 target3 target4 target5 target6 target7

.PHONY: default clean install uninstall

default: checkcookie $(targets)

checkcookie:
	@if ! test -f "cookie"; then \
		echo -e "Cookie not set. Please run './setcookie <uniqname>'.\n"; \
		exit 1; \
	fi

target0: CFLAGS += -fno-stack-protector -z execstack 
target1: CFLAGS += -fno-stack-protector -z execstack 
target2: CFLAGS += -fno-stack-protector -z execstack 
target3: CFLAGS += -fno-stack-protector -z execstack 
target4: CFLAGS += -fno-stack-protector -z execstack
target5: CFLAGS += -fno-stack-protector
target6: CFLAGS += -fno-stack-protector -z execstack -DMINIASLR
target7: CFLAGS += -fno-stack-protector -z noexecstack

target0: target0.c helper.c
target1: target1.c helper.c
target2: target2.c helper.c
target3: target3.c helper.c
target4: target4.c helper.c
target5: target5.c helper.c
target6: target6.c helper.c
target7: target7.c helper.c

clean:
	rm -f $(targets) cookie
